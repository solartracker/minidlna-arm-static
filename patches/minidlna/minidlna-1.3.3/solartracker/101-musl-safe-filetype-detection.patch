--- a/monitor.c	2026-01-31 22:57:20.795791811 -0500
+++ b/monitor.c	2026-02-01 09:04:02.590567111 -0500
@@ -137,6 +137,8 @@
 int
 monitor_insert_file(const char *name, const char *path)
 {
+	DPRINTF(E_WARN, L_INOTIFY, "---ENTERING monitor_insert_file: name='%s' path='%s'\n", name, path);
+
 	int len;
 	char *last_dir;
 	char *path_buf;
@@ -292,8 +294,10 @@
 int
 monitor_insert_directory(int fd, char *name, const char * path)
 {
+	DPRINTF(E_WARN, L_INOTIFY, "---ENTERING monitor_insert_directory: name='%s' path='%s'\n", name, path);
 	DIR * ds;
 	struct dirent * e;
+	struct stat st;
 	char *id, *parent_buf, *esc_name;
 	char path_buf[PATH_MAX];
 	enum file_types type = TYPE_UNKNOWN;
@@ -327,8 +331,9 @@
 		monitor_add_watch(fd, path);
 #endif
 
-	dir_types = valid_media_types(path);
+	dir_types = ALL_MEDIA; //valid_media_types(path);
 
+	DPRINTF(E_WARN, L_INOTIFY, "---opendir(%s)\n", path);
 	ds = opendir(path);
 	if( !ds )
 	{
@@ -337,25 +342,41 @@
 	}
 	while( !quitting && (e = readdir(ds)) )
 	{
+		DPRINTF(E_WARN, L_INOTIFY, "------Enumerating directory items: %s\n", e->d_name);
+		type = TYPE_UNKNOWN;
+
 		if( e->d_name[0] == '.' )
 			continue;
 		esc_name = escape_tag(e->d_name, 1);
 		snprintf(path_buf, sizeof(path_buf), "%s/%s", path, e->d_name);
-		switch( e->d_type )
+
+		/* --- New musl-safe type detection --- */
+		if( e->d_type == DT_UNKNOWN )
 		{
-			case DT_DIR:
-			case DT_REG:
-			case DT_LNK:
-			case DT_UNKNOWN:
-				type = resolve_unknown_type(path_buf, dir_types);
-			default:
-				break;
+		    if( lstat(path_buf, &st) == 0 )
+		    {
+		        if( S_ISDIR(st.st_mode) )
+		            type = TYPE_DIR;
+		        else if( S_ISREG(st.st_mode) )
+		            type = TYPE_FILE;
+		        else
+		            type = TYPE_UNKNOWN;
+		    }
+		    else
+		    {
+		        type = TYPE_UNKNOWN;
+		    }
+		}
+		else
+		{
+		    type = resolve_unknown_type(path_buf, dir_types);
 		}
+
 		if( type == TYPE_DIR )
 		{
 			monitor_insert_directory(fd, esc_name, path_buf);
 		}
-		else if( type == TYPE_FILE && check_notsparse(path_buf)) {
+		else if( type == TYPE_FILE /*&& check_notsparse(path_buf)*/) {
 			monitor_insert_file(esc_name, path_buf);
 		}
 		free(esc_name);
